plugins {
    id 'java'
    id 'application'
    id 'com.google.cloud.tools.jib' version '1.0.1'
}

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
    implementation 'com.redhat.rhjmc:containerjfr-core:0.1.4'
}

mainClassName = 'com.redhat.rhjmc.containerjfr.reports.Generator'

jib {
    from {
        image = 'gcr.io/distroless/java:11'
    }
    to {
        image = 'quay.io/rh-jmc-team/container-jfr-reports-generator'
    }
    container {
        useCurrentTimestamp = true
        ports = ['9091']
        jvmFlags = [
            '-XX:+CrashOnOutOfMemoryError',
            '-Dorg.openjdk.jmc.common.security.manager=com.redhat.rhjmc.containerjfr.core.jmc.SecurityManager',
            '-Dcom.sun.management.jmxremote.rmi.port=9091',
            '-Dcom.sun.management.jmxremote=true',
            '-Dcom.sun.management.jmxremote.port=9091',
            '-Dcom.sun.management.jmxremote.ssl=false',
            '-Dcom.sun.management.jmxremote.authenticate=false',
            '-Dcom.sun.management.jmxremote.local.only=false',
            '-Djava.rmi.server.hostname=container-jfr-reports-generator'
        ]
    }
}
